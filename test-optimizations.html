<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¼˜åŒ–åŠŸèƒ½æµ‹è¯• - å¡”ç½—ç‰Œå åœ</title>
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/mobile-optimization.css">
    <style>
        .test-section {
            margin: 30px 0;
            padding: 20px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .test-section h2 {
            color: #667eea;
            margin-bottom: 15px;
        }
        
        .test-button {
            margin: 10px 5px;
            padding: 10px 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
        }
        
        .test-button:hover {
            opacity: 0.9;
        }
        
        .test-result {
            margin-top: 15px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 5px;
            min-height: 50px;
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        
        .stat-card {
            padding: 15px;
            background: linear-gradient(135deg, #667eea15 0%, #764ba215 100%);
            border-radius: 8px;
            text-align: center;
        }
        
        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #667eea;
        }
        
        .stat-label {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ§ª ä¼˜åŒ–åŠŸèƒ½æµ‹è¯•</h1>
            <p class="subtitle">æµ‹è¯•æ€§èƒ½ç¼“å­˜ã€æ¸è¿›å¼æ˜¾ç¤ºã€é”™è¯¯å¤„ç†å’Œç§»åŠ¨ç«¯ä¼˜åŒ–</p>
        </header>

        <main>
            <!-- æµ‹è¯•1: æ€§èƒ½ç¼“å­˜ -->
            <div class="test-section">
                <h2>1ï¸âƒ£ æ€§èƒ½ç¼“å­˜æµ‹è¯•</h2>
                <p>æµ‹è¯•ç¼“å­˜æœºåˆ¶æ˜¯å¦æ­£å¸¸å·¥ä½œï¼Œä»¥åŠç¼“å­˜å‘½ä¸­ç‡</p>
                <button class="test-button" id="testCache1">é¦–æ¬¡ç”Ÿæˆæ€»ç»“</button>
                <button class="test-button" id="testCache2">å†æ¬¡ç”Ÿæˆï¼ˆåº”ä½¿ç”¨ç¼“å­˜ï¼‰</button>
                <button class="test-button" id="testCache3">ä¸åŒå‚æ•°ï¼ˆç¼“å­˜æœªå‘½ä¸­ï¼‰</button>
                <button class="test-button" id="clearCache">æ¸…é™¤ç¼“å­˜</button>
                <button class="test-button" id="showCacheStats">æ˜¾ç¤ºç¼“å­˜ç»Ÿè®¡</button>
                <div class="test-result" id="cacheResult"></div>
                <div class="stats" id="cacheStats"></div>
            </div>

            <!-- æµ‹è¯•2: æ¸è¿›å¼æ˜¾ç¤º -->
            <div class="test-section">
                <h2>2ï¸âƒ£ æ¸è¿›å¼æ˜¾ç¤ºæµ‹è¯•</h2>
                <p>æµ‹è¯•åŠ è½½æŒ‡ç¤ºå™¨ã€è¿›åº¦æ¡å’Œå¯æŠ˜å åŒºå—</p>
                <button class="test-button" id="testLoading">æ˜¾ç¤ºåŠ è½½æŒ‡ç¤ºå™¨</button>
                <button class="test-button" id="testProgress">æ˜¾ç¤ºè¿›åº¦æ¡</button>
                <button class="test-button" id="testCollapsible">åˆ›å»ºå¯æŠ˜å åŒºå—</button>
                <button class="test-button" id="testProgressive">æ¸è¿›å¼æ˜¾ç¤ºå…ƒç´ </button>
                <div class="test-result" id="displayResult"></div>
            </div>

            <!-- æµ‹è¯•3: é”™è¯¯å¤„ç† -->
            <div class="test-section">
                <h2>3ï¸âƒ£ é”™è¯¯å¤„ç†æµ‹è¯•</h2>
                <p>æµ‹è¯•é”™è¯¯æ•è·ã€ç”¨æˆ·æç¤ºå’Œé™çº§å¤„ç†</p>
                <button class="test-button" id="testError">è§¦å‘é”™è¯¯</button>
                <button class="test-button" id="testWarning">æ˜¾ç¤ºè­¦å‘Š</button>
                <button class="test-button" id="testSuccess">æ˜¾ç¤ºæˆåŠŸ</button>
                <button class="test-button" id="testSafeExecute">å®‰å…¨æ‰§è¡Œï¼ˆå¸¦é™çº§ï¼‰</button>
                <button class="test-button" id="showErrorLog">æ˜¾ç¤ºé”™è¯¯æ—¥å¿—</button>
                <div class="test-result" id="errorResult"></div>
            </div>

            <!-- æµ‹è¯•4: ç§»åŠ¨ç«¯ä¼˜åŒ– -->
            <div class="test-section">
                <h2>4ï¸âƒ£ ç§»åŠ¨ç«¯ä¼˜åŒ–æµ‹è¯•</h2>
                <p>è°ƒæ•´æµè§ˆå™¨çª—å£å¤§å°æˆ–ä½¿ç”¨å¼€å‘è€…å·¥å…·çš„è®¾å¤‡æ¨¡æ‹Ÿå™¨æµ‹è¯•å“åº”å¼å¸ƒå±€</p>
                <div class="test-result">
                    <h4>æµ‹è¯•é¡¹ç›®ï¼š</h4>
                    <ul>
                        <li>âœ… å­—ä½“å¤§å°è‡ªåŠ¨è°ƒæ•´</li>
                        <li>âœ… æŒ‰é’®è§¦æ‘¸åŒºåŸŸå¢å¤§ï¼ˆæœ€å°44pxï¼‰</li>
                        <li>âœ… å¡ç‰‡å¸ƒå±€å“åº”å¼è°ƒæ•´</li>
                        <li>âœ… å¯¼èˆªèœå•ç§»åŠ¨ç«¯é€‚é…</li>
                        <li>âœ… æ·±è‰²æ¨¡å¼æ”¯æŒï¼ˆç³»ç»Ÿè®¾ç½®ï¼‰</li>
                    </ul>
                    <p style="margin-top: 15px; color: #667eea;">
                        ğŸ’¡ æç¤ºï¼šæ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·ï¼ˆF12ï¼‰ï¼Œåˆ‡æ¢åˆ°ç§»åŠ¨è®¾å¤‡è§†å›¾è¿›è¡Œæµ‹è¯•
                    </p>
                </div>
            </div>

            <!-- ç»¼åˆæ€§èƒ½ç»Ÿè®¡ -->
            <div class="test-section">
                <h2>ğŸ“Š ç»¼åˆæ€§èƒ½ç»Ÿè®¡</h2>
                <div class="stats" id="performanceStats">
                    <div class="stat-card">
                        <div class="stat-value" id="totalTests">0</div>
                        <div class="stat-label">æ€»æµ‹è¯•æ¬¡æ•°</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="cacheHitRate">0%</div>
                        <div class="stat-label">ç¼“å­˜å‘½ä¸­ç‡</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="avgResponseTime">0ms</div>
                        <div class="stat-label">å¹³å‡å“åº”æ—¶é—´</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="errorCount">0</div>
                        <div class="stat-label">é”™è¯¯æ¬¡æ•°</div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script type="module">
        import { summaryCache, getCachedAdvancedSummary } from './js/utils/performance-cache.js';
        import { 
            createLoadingIndicator, 
            ProgressBar, 
            makeCollapsible,
            showElementProgressively,
            showElementsProgressively
        } from './js/utils/progressive-display.js';
        import { 
            showErrorMessage, 
            safeExecute, 
            errorHandler,
            setupGlobalErrorHandling
        } from './js/utils/error-handler.js';
        import { generateAdvancedSummary } from './js/advanced-summary.js';

        // å¯ç”¨å…¨å±€é”™è¯¯å¤„ç†
        setupGlobalErrorHandling();

        // æµ‹è¯•æ•°æ®
        const testCards1 = [
            { name: 'æ„šè€…', reversed: false },
            { name: 'é­”æœ¯å¸ˆ', reversed: false },
            { name: 'å¥³ç¥­å¸', reversed: true }
        ];

        const testCards2 = [
            { name: 'çš‡å¸', reversed: false },
            { name: 'æ•™çš‡', reversed: true }
        ];

        let testCount = 0;
        let responseTimes = [];

        // æµ‹è¯•1: ç¼“å­˜åŠŸèƒ½
        document.getElementById('testCache1').addEventListener('click', async () => {
            const start = performance.now();
            const result = await getCachedAdvancedSummary(testCards1, 'æµ‹è¯•é—®é¢˜1', 'love');
            const duration = performance.now() - start;
            
            responseTimes.push(duration);
            testCount++;
            
            document.getElementById('cacheResult').innerHTML = `
                <strong>é¦–æ¬¡ç”Ÿæˆï¼š</strong><br>
                è€—æ—¶: ${duration.toFixed(2)}ms<br>
                ç¼“å­˜çŠ¶æ€: ${summaryCache.stats().size} é¡¹å·²ç¼“å­˜
            `;
            updateStats();
        });

        document.getElementById('testCache2').addEventListener('click', async () => {
            const start = performance.now();
            const result = await getCachedAdvancedSummary(testCards1, 'æµ‹è¯•é—®é¢˜1', 'love');
            const duration = performance.now() - start;
            
            responseTimes.push(duration);
            testCount++;
            
            document.getElementById('cacheResult').innerHTML = `
                <strong>å†æ¬¡ç”Ÿæˆï¼ˆä½¿ç”¨ç¼“å­˜ï¼‰ï¼š</strong><br>
                è€—æ—¶: ${duration.toFixed(2)}ms<br>
                <span style="color: green;">âš¡ é€Ÿåº¦æå‡: ${((responseTimes[0] / duration - 1) * 100).toFixed(0)}%</span>
            `;
            updateStats();
        });

        document.getElementById('testCache3').addEventListener('click', async () => {
            const start = performance.now();
            const result = await getCachedAdvancedSummary(testCards2, 'æµ‹è¯•é—®é¢˜2', 'career');
            const duration = performance.now() - start;
            
            responseTimes.push(duration);
            testCount++;
            
            document.getElementById('cacheResult').innerHTML = `
                <strong>ä¸åŒå‚æ•°ï¼ˆç¼“å­˜æœªå‘½ä¸­ï¼‰ï¼š</strong><br>
                è€—æ—¶: ${duration.toFixed(2)}ms<br>
                ç¼“å­˜çŠ¶æ€: ${summaryCache.stats().size} é¡¹å·²ç¼“å­˜
            `;
            updateStats();
        });

        document.getElementById('clearCache').addEventListener('click', () => {
            summaryCache.clear();
            document.getElementById('cacheResult').innerHTML = `
                <strong>âœ… ç¼“å­˜å·²æ¸…é™¤</strong><br>
                å½“å‰ç¼“å­˜: ${summaryCache.stats().size} é¡¹
            `;
            updateStats();
        });

        document.getElementById('showCacheStats').addEventListener('click', () => {
            const stats = summaryCache.stats();
            document.getElementById('cacheStats').innerHTML = `
                <div class="stat-card">
                    <div class="stat-value">${stats.size}</div>
                    <div class="stat-label">ç¼“å­˜é¡¹æ•°</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${stats.hits}</div>
                    <div class="stat-label">ç¼“å­˜å‘½ä¸­</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${stats.misses}</div>
                    <div class="stat-label">ç¼“å­˜æœªå‘½ä¸­</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${stats.hitRate}%</div>
                    <div class="stat-label">å‘½ä¸­ç‡</div>
                </div>
            `;
        });

        // æµ‹è¯•2: æ¸è¿›å¼æ˜¾ç¤º
        document.getElementById('testLoading').addEventListener('click', () => {
            const result = document.getElementById('displayResult');
            result.innerHTML = '';
            const loading = createLoadingIndicator('æ­£åœ¨åŠ è½½æµ‹è¯•æ•°æ®...');
            result.appendChild(loading);
            
            setTimeout(() => {
                loading.remove();
                result.innerHTML = '<p style="color: green;">âœ… åŠ è½½å®Œæˆï¼</p>';
            }, 3000);
        });

        document.getElementById('testProgress').addEventListener('click', async () => {
            const result = document.getElementById('displayResult');
            result.innerHTML = '';
            
            const progressBar = new ProgressBar(result, 5);
            
            for (let i = 1; i <= 5; i++) {
                await new Promise(resolve => setTimeout(resolve, 800));
                progressBar.update(i, `æ­¥éª¤ ${i}/5 å®Œæˆ`);
            }
            
            progressBar.complete('å…¨éƒ¨å®Œæˆï¼');
        });

        document.getElementById('testCollapsible').addEventListener('click', () => {
            const result = document.getElementById('displayResult');
            result.innerHTML = `
                <div id="collapsibleTest">
                    <p>è¿™æ˜¯ä¸€æ®µå¯æŠ˜å çš„å†…å®¹ã€‚ç‚¹å‡»æ ‡é¢˜å¯ä»¥å±•å¼€æˆ–æ”¶èµ·ã€‚</p>
                    <p>æ”¯æŒé»˜è®¤å±•å¼€æˆ–æ”¶èµ·çŠ¶æ€ã€‚</p>
                    <p>é€‚åˆç”¨äºé•¿ç¯‡è§£è¯»å†…å®¹çš„ç»„ç»‡ã€‚</p>
                </div>
            `;
            
            const testDiv = document.getElementById('collapsibleTest');
            makeCollapsible(testDiv, 'ğŸ“¦ å¯æŠ˜å åŒºå—ç¤ºä¾‹', true);
        });

        document.getElementById('testProgressive').addEventListener('click', async () => {
            const result = document.getElementById('displayResult');
            result.innerHTML = '';
            
            for (let i = 1; i <= 5; i++) {
                const div = document.createElement('div');
                div.style.padding = '10px';
                div.style.margin = '5px 0';
                div.style.background = '#f0f0f0';
                div.style.borderRadius = '5px';
                div.textContent = `å…ƒç´  ${i}`;
                result.appendChild(div);
            }
            
            const elements = result.querySelectorAll('div');
            await showElementsProgressively(elements, 200);
        });

        // æµ‹è¯•3: é”™è¯¯å¤„ç†
        document.getElementById('testError').addEventListener('click', () => {
            showErrorMessage('è¿™æ˜¯ä¸€ä¸ªé”™è¯¯æç¤ºç¤ºä¾‹', 'error');
        });

        document.getElementById('testWarning').addEventListener('click', () => {
            showErrorMessage('è¿™æ˜¯ä¸€ä¸ªè­¦å‘Šæç¤ºç¤ºä¾‹', 'warning');
        });

        document.getElementById('testSuccess').addEventListener('click', () => {
            showErrorMessage('æ“ä½œæˆåŠŸå®Œæˆï¼', 'success');
        });

        document.getElementById('testSafeExecute').addEventListener('click', async () => {
            const result = await safeExecute(
                () => {
                    throw new Error('æ¨¡æ‹Ÿé”™è¯¯');
                },
                () => {
                    return 'ä½¿ç”¨é™çº§æ–¹æ¡ˆçš„ç»“æœ';
                },
                'ä¸»è¦æ“ä½œå¤±è´¥'
            );
            
            document.getElementById('errorResult').innerHTML = `
                <strong>å®‰å…¨æ‰§è¡Œç»“æœï¼š</strong><br>
                ${result}
            `;
        });

        document.getElementById('showErrorLog').addEventListener('click', () => {
            const errors = errorHandler.getErrors();
            document.getElementById('errorResult').innerHTML = `
                <strong>é”™è¯¯æ—¥å¿—ï¼ˆæœ€è¿‘${errors.length}æ¡ï¼‰ï¼š</strong><br>
                ${errors.length === 0 ? 'æš‚æ— é”™è¯¯' : errors.map((e, i) => 
                    `${i + 1}. ${e.message} (${e.type}) - ${new Date(e.timestamp).toLocaleTimeString()}`
                ).join('<br>')}
            `;
        });

        // æ›´æ–°ç»Ÿè®¡
        function updateStats() {
            document.getElementById('totalTests').textContent = testCount;
            
            const stats = summaryCache.stats();
            document.getElementById('cacheHitRate').textContent = stats.hitRate + '%';
            
            if (responseTimes.length > 0) {
                const avg = responseTimes.reduce((a, b) => a + b, 0) / responseTimes.length;
                document.getElementById('avgResponseTime').textContent = avg.toFixed(2) + 'ms';
            }
            
            document.getElementById('errorCount').textContent = errorHandler.getErrors().length;
        }

        // åˆå§‹åŒ–ç»Ÿè®¡
        updateStats();
    </script>
</body>
</html>
